<video id="video" autoplay playsinline muted style="width:100%; height:auto; background:#000;"></video>
<br>
<button id="start">Start Camera</button>
<button id="photoBtn">Take Photo</button>
<canvas id="canvas" style="display:none;"></canvas>
<img id="photo" style="width:100px; margin-top:10px;">

<script>
let stream;

document.getElementById('start').addEventListener('click', async () => {
  try {
    // ⚡ Mobile-friendly constraints
    const constraints = {
      video: {
        facingMode: { exact: "environment" }, // back camera preferred
        width: { ideal: 1280 },
        height: { ideal: 720 }
      },
      audio: false
    };

    stream = await navigator.mediaDevices.getUserMedia(constraints);

    const video = document.getElementById('video');
    video.srcObject = stream;

    // ⚡ Mobile requires explicit play
    video.onloadedmetadata = () => {
      video.play().catch(err => console.error("Video play failed:", err));
    };

  } catch(err) {
    alert("Camera access failed: " + err);
    console.error(err);
  }
});

document.getElementById('photoBtn').addEventListener('click', () => {
  if(!stream) { alert("Start camera first!"); return; }
  const video = document.getElementById('video');
  const canvas = document.getElementById('canvas');
  const photo = document.getElementById('photo');

  canvas.width = video.videoWidth || 640;
  canvas.height = video.videoHeight || 480;
  canvas.getContext('2d').drawImage(video, 0, 0);

  photo.src = canvas.toDataURL('image/png');
});
</script>